PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX base: <http://www.gutenberg.org/>
PREFIX agent: <http://www.gutenberg.org/2009/agents/>

SELECT DISTINCT ?book_uri WHERE {
  ?lang rdf:value "de"^^<http://purl.org/dc/terms/RFC4646> .
  ?book_uri <http://purl.org/dc/terms/language> ?lang .
  FILTER NOT EXISTS {
    ?book_uri <http://purl.org/dc/terms/hasFormat> ?format .
    FILTER(STRENDS(STR(?format), "tei")) .
  }
  FILTER EXISTS {
    ?book_uri <http://purl.org/dc/terms/hasFormat> ?format .
    FILTER(STRENDS(STR(?format), "txt") || STRENDS(STR(?format), "txt.utf-8"))  .
  }
}
